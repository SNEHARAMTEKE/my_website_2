---
# categories:
# - tranquilpeak
# - showcase
date: "2022-09-18"
slug: EDA in R
thumbnailImage: images/eda.jpg
thumbnailImagePosition: left
title: EDA in R
---



<p>Here you can find a basic Exploratory Data Analysis exercise in R</p>
<!--more-->
<div id="rents-in-san-francsisco-2000-2018" class="section level1">
<h1>Rents in San Francsisco 2000-2018</h1>
<p><a href="https://www.katepennington.org/data">Kate Pennington</a> created a panel of historic Craigslist rents by scraping posts archived by the Wayback Machine. You can read more about her work here</p>
<p>In our case, we have a clean(ish) dataset with about 200K rows tht corresponf to Craigslist listings for renting properties in the greater SF area. The data dictionary is as follows</p>
<table>
<thead>
<tr class="header">
<th>variable</th>
<th>class</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>post_id</td>
<td>character</td>
<td>Unique ID</td>
</tr>
<tr class="even">
<td>date</td>
<td>double</td>
<td>date</td>
</tr>
<tr class="odd">
<td>year</td>
<td>double</td>
<td>year</td>
</tr>
<tr class="even">
<td>nhood</td>
<td>character</td>
<td>neighborhood</td>
</tr>
<tr class="odd">
<td>city</td>
<td>character</td>
<td>city</td>
</tr>
<tr class="even">
<td>county</td>
<td>character</td>
<td>county</td>
</tr>
<tr class="odd">
<td>price</td>
<td>double</td>
<td>price in USD</td>
</tr>
<tr class="even">
<td>beds</td>
<td>double</td>
<td>n of beds</td>
</tr>
<tr class="odd">
<td>baths</td>
<td>double</td>
<td>n of baths</td>
</tr>
<tr class="even">
<td>sqft</td>
<td>double</td>
<td>square feet of rental</td>
</tr>
<tr class="odd">
<td>room_in_apt</td>
<td>double</td>
<td>room in apartment</td>
</tr>
<tr class="even">
<td>address</td>
<td>character</td>
<td>address</td>
</tr>
<tr class="odd">
<td>lat</td>
<td>double</td>
<td>latitude</td>
</tr>
<tr class="even">
<td>lon</td>
<td>double</td>
<td>longitude</td>
</tr>
<tr class="odd">
<td>title</td>
<td>character</td>
<td>title of listing</td>
</tr>
<tr class="even">
<td>descr</td>
<td>character</td>
<td>description</td>
</tr>
<tr class="odd">
<td>details</td>
<td>character</td>
<td>additional details</td>
</tr>
</tbody>
</table>
<p>The dataset was used in a recent <a href="https://github.com/rfordatascience/tidytuesday">tidyTuesday</a> project.</p>
<pre class="r"><code># download directly off tidytuesdaygithub repo

rent &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-07-05/rent.csv&#39;)
## Rows: 200796 Columns: 17
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (8): post_id, nhood, city, county, address, title, descr, details
## dbl (9): date, year, price, beds, baths, sqft, room_in_apt, lat, lon
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>What are the variable types? Do they all correspond to what they really are? Which variables have most missing values?</p>
<blockquote>
<p>There are mainly two types of variables double(numeric) and character(categorical). All the columns except date and year have correct datatypes. Dates can be converted to time data types to facilitate time series analysis. Description variable has the most missing values.</p>
</blockquote>
<pre class="r"><code># YOUR CODE GOES HERE
skimr::skim(rent)</code></pre>
<table style="width: auto;" class="table table-condensed">
<caption>
(#tab:skim_data)Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
rent
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
200796
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
max
</th>
<th style="text-align:right;">
empty
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:right;">
whitespace
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
post_id
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
200796
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
nhood
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
167
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
city
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
104
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
county
</td>
<td style="text-align:right;">
1394
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
address
</td>
<td style="text-align:right;">
196888
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2869
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
title
</td>
<td style="text-align:right;">
2517
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
298
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
184961
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
descr
</td>
<td style="text-align:right;">
197542
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
16975
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3025
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
details
</td>
<td style="text-align:right;">
192780
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
595
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7667
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
date
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
20095718.38
</td>
<td style="text-align:right;">
44694.07
</td>
<td style="text-align:right;">
20000902.00
</td>
<td style="text-align:right;">
20050227.00
</td>
<td style="text-align:right;">
20110924.00
</td>
<td style="text-align:right;">
20120805.0
</td>
<td style="text-align:right;">
20180717.00
</td>
<td style="text-align:left;">
▁▇▁▆▃
</td>
</tr>
<tr>
<td style="text-align:left;">
year
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
2009.51
</td>
<td style="text-align:right;">
4.48
</td>
<td style="text-align:right;">
2000.00
</td>
<td style="text-align:right;">
2005.00
</td>
<td style="text-align:right;">
2011.00
</td>
<td style="text-align:right;">
2012.0
</td>
<td style="text-align:right;">
2018.00
</td>
<td style="text-align:left;">
▁▇▁▆▃
</td>
</tr>
<tr>
<td style="text-align:left;">
price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
2135.36
</td>
<td style="text-align:right;">
1427.75
</td>
<td style="text-align:right;">
220.00
</td>
<td style="text-align:right;">
1295.00
</td>
<td style="text-align:right;">
1800.00
</td>
<td style="text-align:right;">
2505.0
</td>
<td style="text-align:right;">
40000.00
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
beds
</td>
<td style="text-align:right;">
6608
</td>
<td style="text-align:right;">
0.97
</td>
<td style="text-align:right;">
1.89
</td>
<td style="text-align:right;">
1.08
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
2.00
</td>
<td style="text-align:right;">
3.0
</td>
<td style="text-align:right;">
12.00
</td>
<td style="text-align:left;">
▇▂▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
baths
</td>
<td style="text-align:right;">
158121
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
1.68
</td>
<td style="text-align:right;">
0.69
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
2.00
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
8.00
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
sqft
</td>
<td style="text-align:right;">
136117
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
1201.83
</td>
<td style="text-align:right;">
5000.22
</td>
<td style="text-align:right;">
80.00
</td>
<td style="text-align:right;">
750.00
</td>
<td style="text-align:right;">
1000.00
</td>
<td style="text-align:right;">
1360.0
</td>
<td style="text-align:right;">
900000.00
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
room_in_apt
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
lat
</td>
<td style="text-align:right;">
193145
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
37.67
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
33.57
</td>
<td style="text-align:right;">
37.40
</td>
<td style="text-align:right;">
37.76
</td>
<td style="text-align:right;">
37.8
</td>
<td style="text-align:right;">
40.43
</td>
<td style="text-align:left;">
▁▁▅▇▁
</td>
</tr>
<tr>
<td style="text-align:left;">
lon
</td>
<td style="text-align:right;">
196484
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
-122.21
</td>
<td style="text-align:right;">
0.78
</td>
<td style="text-align:right;">
-123.20
</td>
<td style="text-align:right;">
-122.42
</td>
<td style="text-align:right;">
-122.26
</td>
<td style="text-align:right;">
-122.0
</td>
<td style="text-align:right;">
-74.20
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
</tbody>
</table>
<p>Make a plot that shows the top 20 cities in terms of % of classifieds between 2000-2018. You need to calculate the number of listings by city, and then convert that number to a %.</p>
<pre class="r"><code>#creating data
data1 &lt;- rent %&gt;% 
 filter((year&gt;= 2000) &amp; (year &lt;= 2018)) %&gt;% #filter for years 
 group_by(city) %&gt;%   #group at city level
 summarise(classifieds_city = count(city)) %&gt;% #number of listings by city
 mutate(classifieds = classifieds_city/sum(classifieds_city)) %&gt;% #% of classifieds
 slice_max(order_by = classifieds, n = 20) #select top 20 cities by % of classifieds

#plotting bargraph
plot1 &lt;- ggplot(data1, aes(x = classifieds, y = fct_reorder(city, classifieds, max))) + 
         geom_bar(stat = &#39;identity&#39;) + 
         scale_x_continuous(labels = scales::percent_format(accuracy = 1)) + 
         labs(title = &quot;Top 20 cities by % classifieds between 2000 to 2018&quot;, 
              subtitle = &quot;San Francisco contributes to more than quarter of the rent listings&quot;, 
              caption = &quot;Source: Pennington. Kate (2018). Bav Area Craigslist Rental Housing Posts 2000-2018&quot;,
              x = &quot;% Classifieds&quot;,
              y = &quot;City&quot;)

plot1</code></pre>
<p><img src="/posts/2020-12-01-r-rmarkdown/index.en-us_files/figure-html/top_cities-1.png" width="672" /></p>
<p>Make a plot that shows the evolution of median prices in San Francisco for 0, 1, 2, and 3 bedrooms listings. The final graph should look like this</p>
<pre class="r"><code># data creation
target &lt;- c(0, 1, 2, 3) # beds vector to filter
data2 &lt;- rent %&gt;% 
  filter((city == &quot;san francisco&quot;)&amp;(beds %in% target)) %&gt;% # filter by city and number of beds
  group_by(year, beds) %&gt;% # grouped at year and bed level
  summarise(median_price = median(price)) # calculate median price
## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.

# plot creation
plot2 &lt;- ggplot(data2, aes(x = year, y = median_price, colour = beds)) + 
         geom_line() + 
         facet_grid(~beds) + 
         theme(legend.position=&quot;none&quot;) +
         labs(title = &quot;Evolution of median prices in San Francisco for 0, 1, 2, and 3 bedrooms&quot;, 
              subtitle = &quot;Rent prices in San Francisco have been steadily rising over the years&quot;, 
              caption = &quot;Source: Pennington, Kate (2018). Bay Area Craigslist Rental Housing Posts, 2000-2018&quot;,
              x = &quot;Year&quot;,
              y = &quot;Median Price&quot;)

plot2</code></pre>
<p><img src="/posts/2020-12-01-r-rmarkdown/index.en-us_files/figure-html/sf_median_prices-1.png" width="672" /></p>
<p>Finally, make a plot that shows median rental prices for the top 12 cities in the Bay area. Your final graph should look like this</p>
<pre class="r"><code># code to extract top 12 cities
data5 &lt;- rent %&gt;% 
         group_by(city) %&gt;% # grouped at city level
         summarise(classifieds_city = count(city)) %&gt;% # number of listings by city
         mutate(classifieds = classifieds_city/sum(classifieds_city)) %&gt;% #% of listings by city
         slice_max(order_by = classifieds, n = 12) %&gt;% # select top 12 cities by % of listings
         pull(city) #extract

# data creation
data4 &lt;- rent %&gt;% 
         filter((beds == 1)&amp;(city %in% data5)) %&gt;% #filter for 1 bed and top 12 city
         group_by(city, year) %&gt;% #grouped at city and year level
         summarise(median_price = median(price)) #calculate median price
## `summarise()` has grouped output by &#39;city&#39;. You can override using the
## `.groups` argument.

# plot graph
plot4 &lt;- ggplot(data4, aes(x = year, y = median_price, colour = city)) + 
         geom_line() + 
         facet_wrap(~city, nrow = 3) + 
         theme(legend.position=&quot;none&quot;) +
         labs(title = &quot;Median rent prices in top 12 cities in Bay Area&quot;, 
              subtitle = &quot;The rent prices in top 12 cities show increasing trend over the years&quot;,
              caption = &quot;Source: Pennington, Kate (2018). Bay Area Craigslist Rental Housing Posts, 2000-2018&quot;,
              x = &quot;Year&quot;,
              y = &quot;Median Price&quot;)

plot4</code></pre>
<p><img src="/posts/2020-12-01-r-rmarkdown/index.en-us_files/figure-html/spirit_plot-1.png" width="672" /></p>
<p>What can you infer from these plots? Don’t just explain what’s in the graph, but speculate or tell a short story (1-2 paragraphs max).</p>
<blockquote>
<p>The analysis above shows that San Francisco owns up more than quarter of the total rental listings in the Bay area. In particularly san francisco, we can see that the prices for different types of bedrooms all show increasing trends and as the number of beds increase the price trends get steeper signifying that rentals with more beds has more price increase over the years. The price increase may be attributed to factors like inflation and increasing demand.</p>
</blockquote>
</div>
